<div class="container">
  <div class="row" *ngIf="game$ | async as game">
    <div class="video-area col-8">
      <h1 class="mt-3">{{ game.name }}</h1>
      <div class="video-player">
        <video
          src="{{ game.video_src }}"
          poster="{{ game.image }}"
          preload="none"
          playsInline="true"
          controls
        ></video>
      </div>
    </div>
    <div class="header-area col-4">
      <div class="img-container">
        <img src="{{ game.image }}" alt="{{ game.name }}" />
      </div>
      <div class="score">
        <h4>{{ game.release_date }}</h4>
        <div>
          <p *ngIf="game.rating >= 95" class="positive-rev">
            Overwhelmingly Positive <span>({{ game.reviews }})</span>
          </p>
          <p
            *ngIf="game.rating >= 80 && game.rating <= 94"
            class="positive-rev"
          >
            Very Positive <span>({{ game.reviews }})</span>
          </p>
          <p
            *ngIf="game.rating >= 70 && game.rating <= 79"
            class="positive-rev"
          >
            Mostly Positive <span>({{ game.reviews }})</span>
          </p>
          <p *ngIf="game.rating >= 40 && game.rating <= 69" class="mixed-rev">
            Mixed <span>({{ game.reviews }})</span>
          </p>
          <p
            *ngIf="game.rating >= 20 && game.rating <= 39"
            class="negative-rev"
          >
            Mostly Negative <span>({{ game.reviews }})</span>
          </p>
          <p *ngIf="game.rating >= 0 && game.rating <= 19" class="negative-rev">
            Overwhelmingly Negative <span>({{ game.reviews }})</span>
          </p>
          <p *ngIf="!game.rating">This game does not have enough reviews yet</p>
        </div>
      </div>
    </div>

    <div
      class="shopping-area"
      *ngIf="currentUser$ | async as user; else noUser"
    >
      <div *ngIf="game.price !== null; else FTP">
        Buy {{ game.name }}
        <div>
          <div>{{ game.price }}</div>
          <div *ngIf="isInLibrary$ | async as boolean; else notInLibrary">
            <button type="button" class="btn" disabled>In Library</button>
          </div>
          <div *ngIf="isInWishlist$ | async as boolean; else notInWishlist">
            <button
              type="button"
              class="btn"
              (click)="removeFromWishlist(game)"
            >
              Remove from Wishlist
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="description-area">
      <h6>{{ game.description }}</h6>
    </div>
  </div>
</div>

<ng-template #FTP
  ><div>
    Play {{ game.name }}
    <div>Free</div>
    <div *ngIf="isInLibrary$">
      <button type="button" class="btn" disabled>In Library</button>
    </div>
  </div></ng-template
>

<ng-template #notInWishlist>
  <div>
    <button type="button" class="btn" (click)="addToWishlist(game)">
      Add to Wishlist
    </button>
  </div>
</ng-template>

<ng-template #notInLibrary>
  <div>
    <button type="button" class="btn" (click)="addToLibrary(game)">
      Buy Game
    </button>
  </div>
</ng-template>

<ng-template #noUser>
  <div *ngIf="game.price; else free">{{ game.price }}</div>
  <h5>Please log in to purchase this product.</h5>
  <ng-template #free>Free to play</ng-template>
</ng-template>
